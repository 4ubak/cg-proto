syntax = "proto3";

package platform.nsi.v1;

option go_package = "gitlab.com/xakpro/cg-proto/gen/go/platform/nsi/v1";

service NsiService {
  rpc GetCities(GetCitiesRequest) returns (GetCitiesResponse);
  rpc GetCity(GetCityRequest) returns (GetCityResponse);
  
  rpc GetCarMarks(GetCarMarksRequest) returns (GetCarMarksResponse);
  rpc GetCarModels(GetCarModelsRequest) returns (GetCarModelsResponse);
  rpc GetCarGenerations(GetCarGenerationsRequest) returns (GetCarGenerationsResponse);
  
  rpc GetCategories(GetCategoriesRequest) returns (GetCategoriesResponse);
  rpc GetCategory(GetCategoryRequest) returns (GetCategoryResponse);
  
  // Service Groups and Categories (for matching)
  rpc GetServiceGroups(GetServiceGroupsRequest) returns (GetServiceGroupsResponse);
  rpc GetServiceCategories(GetServiceCategoriesRequest) returns (GetServiceCategoriesResponse);
  rpc GetServiceCategory(GetServiceCategoryRequest) returns (GetServiceCategoryResponse);
  rpc ValidateGroupAndCategories(ValidateGroupAndCategoriesRequest) returns (ValidateGroupAndCategoriesResponse);
  
  rpc GetAppVersion(GetAppVersionRequest) returns (GetAppVersionResponse);
  rpc GetConfig(GetConfigRequest) returns (GetConfigResponse);
}

message City {
  string id = 1;
  string name = 2;
  string region = 3;
  string country = 4;
  double lat = 5;
  double lon = 6;
}

message CarMark {
  int32 id = 1;
  string name = 2;
  string logo_url = 3;
  bool is_popular = 4;
}

message CarModel {
  int32 id = 1;
  int32 mark_id = 2;
  string name = 3;
}

message CarGeneration {
  int32 id = 1;
  int32 model_id = 2;
  string name = 3;
  int32 year_start = 4;
  int32 year_end = 5;
}

message Category {
  int32 id = 1;
  int32 parent_id = 2;
  string name = 3;
  string slug = 4;
  string icon_url = 5;
  int32 sort_order = 6;
}

// Service Group represents a service group (СТО, Кузовные, Запчасти, Шины, Автомойка)
message ServiceGroup {
  int64 id = 1;
  string name = 2;
  string slug = 3;
  string icon = 4;
  int32 sort_order = 5;
}

// Service Category represents a service category within a group
message ServiceCategory {
  int64 id = 1;
  int64 group_id = 2;
  string name = 3;
  string slug = 4;
  int32 sort_order = 5;
}

message AppVersion {
  string platform = 1;
  string min_version = 2;
  string current_version = 3;
  bool force_update = 4;
  string update_url = 5;
}

message GetCitiesRequest {
  string query = 1;
  string country = 2;
  int32 limit = 3;
}

message GetCitiesResponse {
  repeated City cities = 1;
}

message GetCityRequest {
  string city_id = 1;
}

message GetCityResponse {
  City city = 1;
}

message GetCarMarksRequest {
  bool popular_only = 1;
}

message GetCarMarksResponse {
  repeated CarMark marks = 1;
}

message GetCarModelsRequest {
  int32 mark_id = 1;
}

message GetCarModelsResponse {
  repeated CarModel models = 1;
}

message GetCarGenerationsRequest {
  int32 model_id = 1;
}

message GetCarGenerationsResponse {
  repeated CarGeneration generations = 1;
}

message GetCategoriesRequest {
  int32 parent_id = 1;
}

message GetCategoriesResponse {
  repeated Category categories = 1;
}

message GetCategoryRequest {
  int32 category_id = 1;
}

message GetCategoryResponse {
  Category category = 1;
}

message GetAppVersionRequest {
  string platform = 1;
}

message GetAppVersionResponse {
  AppVersion version = 1;
}

message GetConfigRequest {
  string key = 1;
}

message GetConfigResponse {
  string value = 1;
}

// Service Groups
message GetServiceGroupsRequest {}

message GetServiceGroupsResponse {
  repeated ServiceGroup groups = 1;
}

// Service Categories
message GetServiceCategoriesRequest {
  int64 group_id = 1;  // Filter by group, 0 = all categories
}

message GetServiceCategoriesResponse {
  repeated ServiceCategory categories = 1;
}

message GetServiceCategoryRequest {
  int64 category_id = 1;
}

message GetServiceCategoryResponse {
  ServiceCategory category = 1;
}

// Validation - checks if category_ids belong to the specified group_id
message ValidateGroupAndCategoriesRequest {
  int64 group_id = 1;
  repeated int64 category_ids = 2;
}

message ValidateGroupAndCategoriesResponse {
  bool valid = 1;
  string error_message = 2;  // Populated if invalid
}

