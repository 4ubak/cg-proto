syntax = "proto3";

package services.catalog.v1;

option go_package = "github.com/4ubak/cg-proto/gen/go/services/catalog;catalog";

import "google/protobuf/timestamp.proto";

// CatalogService manages service categories, catalog and price lists
service CatalogService {
  // Categories
  rpc GetCategories(GetCategoriesRequest) returns (GetCategoriesResponse);
  rpc GetCategory(GetCategoryRequest) returns (GetCategoryResponse);
  rpc GetSubcategories(GetSubcategoriesRequest) returns (GetSubcategoriesResponse);
  rpc GetRootCategories(GetRootCategoriesRequest) returns (GetRootCategoriesResponse);
  
  // Services
  rpc CreateService(CreateServiceRequest) returns (CreateServiceResponse);
  rpc GetService(GetServiceRequest) returns (GetServiceResponse);
  rpc UpdateService(UpdateServiceRequest) returns (UpdateServiceResponse);
  rpc DeleteService(DeleteServiceRequest) returns (DeleteServiceResponse);
  rpc ListServices(ListServicesRequest) returns (ListServicesResponse);
  rpc GetServicesByCategory(GetServicesByCategoryRequest) returns (GetServicesByCategoryResponse);
  
  // Price List
  rpc CreatePriceItem(CreatePriceItemRequest) returns (CreatePriceItemResponse);
  rpc GetPriceItem(GetPriceItemRequest) returns (GetPriceItemResponse);
  rpc UpdatePriceItem(UpdatePriceItemRequest) returns (UpdatePriceItemResponse);
  rpc DeletePriceItem(DeletePriceItemRequest) returns (DeletePriceItemResponse);
  rpc GetPriceList(GetPriceListRequest) returns (GetPriceListResponse);
  rpc ComparePrices(ComparePricesRequest) returns (ComparePricesResponse);
}

// Category messages

message Category {
  int32 id = 1;
  optional int32 parent_id = 2;
  string name = 3;
  string slug = 4;
  string image_url = 5;
  int32 sort_order = 6;
  bool is_active = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message GetCategoriesRequest {}

message GetCategoriesResponse {
  repeated Category categories = 1;
}

message GetCategoryRequest {
  int32 id = 1;
}

message GetCategoryResponse {
  Category category = 1;
}

message GetSubcategoriesRequest {
  int32 parent_id = 1;
}

message GetSubcategoriesResponse {
  repeated Category categories = 1;
}

message GetRootCategoriesRequest {}

message GetRootCategoriesResponse {
  repeated Category categories = 1;
}

// Service messages

message Service {
  int64 id = 1;
  int32 category_id = 2;
  string name = 3;
  string description = 4;
  string image_url = 5;
  int32 sort_order = 6;
  bool is_active = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
  string category_name = 10; // joined data
}

message CreateServiceRequest {
  int32 category_id = 1;
  string name = 2;
  string description = 3;
  string image_url = 4;
  int32 sort_order = 5;
}

message CreateServiceResponse {
  Service service = 1;
}

message GetServiceRequest {
  int64 id = 1;
}

message GetServiceResponse {
  Service service = 1;
}

message UpdateServiceRequest {
  int64 id = 1;
  optional string name = 2;
  optional string description = 3;
  optional string image_url = 4;
  optional int32 sort_order = 5;
  optional bool is_active = 6;
}

message UpdateServiceResponse {
  Service service = 1;
}

message DeleteServiceRequest {
  int64 id = 1;
}

message DeleteServiceResponse {}

message ListServicesRequest {
  optional int32 category_id = 1;
  optional bool is_active = 2;
  optional string query = 3;
  int32 page = 4;
  int32 page_size = 5;
}

message ListServicesResponse {
  repeated Service services = 1;
  int32 total = 2;
  int32 page = 3;
  int32 page_size = 4;
}

message GetServicesByCategoryRequest {
  int32 category_id = 1;
}

message GetServicesByCategoryResponse {
  repeated Service services = 1;
}

// Price List messages

message PriceListItem {
  int64 id = 1;
  int64 organization_id = 2;
  int64 service_id = 3;
  int64 price = 4; // in tiyins
  string currency = 5;
  int32 duration = 6; // minutes
  string description = 7;
  bool is_active = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
  string service_name = 11; // joined data
}

message CreatePriceItemRequest {
  int64 organization_id = 1;
  int64 service_id = 2;
  int64 price = 3;
  string currency = 4;
  int32 duration = 5;
  string description = 6;
}

message CreatePriceItemResponse {
  PriceListItem item = 1;
}

message GetPriceItemRequest {
  int64 id = 1;
}

message GetPriceItemResponse {
  PriceListItem item = 1;
}

message UpdatePriceItemRequest {
  int64 id = 1;
  optional int64 price = 2;
  optional int32 duration = 3;
  optional string description = 4;
  optional bool is_active = 5;
}

message UpdatePriceItemResponse {
  PriceListItem item = 1;
}

message DeletePriceItemRequest {
  int64 id = 1;
}

message DeletePriceItemResponse {}

message GetPriceListRequest {
  int64 organization_id = 1;
  optional int64 service_id = 2;
  optional bool is_active = 3;
  int32 page = 4;
  int32 page_size = 5;
}

message GetPriceListResponse {
  repeated PriceListItem items = 1;
  int32 total = 2;
  int32 page = 3;
  int32 page_size = 4;
}

message OrganizationPrice {
  int64 organization_id = 1;
  string organization_name = 2;
  int64 price = 3;
  string currency = 4;
  int32 duration = 5;
}

message PriceComparison {
  int64 service_id = 1;
  string service_name = 2;
  repeated OrganizationPrice organizations = 3;
  int64 min_price = 4;
  int64 max_price = 5;
  int64 average_price = 6;
}

message ComparePricesRequest {
  int64 service_id = 1;
}

message ComparePricesResponse {
  PriceComparison comparison = 1;
}
